#!/usr/bin/make -f

# CDBS
include /usr/share/cdbs/1/rules/buildcore.mk
include /usr/share/cdbs/1/rules/buildvars.mk
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/cmake.mk

# Bug in cmake 2.8.3
DEB_CMAKE_NORMAL_ARGS = \
	-DCMAKE_BUILD_TYPE:STRING="Release" \
	-DCMAKE_SKIP_RPATH=ON \
	-DCMAKE_VERBOSE_MAKEFILE=ON \
        -DCMAKE_INSTALL_PREFIX:PATH=/usr \
        -DCPACK_SET_DESTDIR=ON

DEB_CMAKE_EXTRA_FLAGS = \
	-DWEBIF=1 -DHAVE_DVBAPI=0 -DIRDETO_GUESSING=1 -DCS_ANTICASC=1 -DWITH_DEBUG=1 -DCS_WITH_DOUBLECHECK=1 -DCS_LED=0 -DQBOXHD_LED=0 -DCS_LOGHISTORY=1 -DWITH_SSL=0 \
	-DMODULE_CAMD33=0 -DMODULE_CAMD35=1 -DMODULE_CAMD35_TCP=0 -DMODULE_NEWCAMD=1 -DMODULE_CCCAM=1 -DMODULE_GBOX=1 -DMODULE_RADEGAST=1 -DMODULE_SERIAL=1 -DMODULE_MONITOR=1 -DMODULE_CONSTCW=1 \
	-DREADER_NAGRA=1 -DREADER_IRDETO=1 -DREADER_CONAX=1 -DREADER_CRYPTOWORKS=1 -DREADER_SECA=1 -DREADER_VIACCESS=1 -DREADER_VIDEOGUARD=1 -DREADER_DRE=1 -DREADER_TONGFANG=1 \
	-DLIBUSBDIR=/usr -DCS_CONFDIR=/etc/oscam-svn -DCS_LOGFILE=/var/log/oscam/oscam-svn.log

DEB_CMAKE_INSTALL_PREFIX = /usr
DEB_BUILDDIR = $(DEB_SRCDIR)/make

makebuilddir/oscam-svn::
   $(shell sed -i "s%/usr/local%/usr%" CMakeLists.txt )
   $(shell grep -Fq "share/doc/oscam-svn" CMakeLists.txt || sed -i "s%share/doc/oscam%share/doc/oscam-svn%" CMakeLists.txt )
   $(shell grep -Fq "/etc/oscam-svn COMPONENT config" CMakeLists.txt || sed -i "s%#----------------------- we can use CPack to build pacakges --------------------------%INSTALL (FILES \$$\{example_files} DESTINATION /etc/oscam-svn COMPONENT config)\nINSTALL (DIRECTORY DESTINATION /var/log/oscam COMPONENT config)%" CMakeLists.txt )
   $(shell grep -Fq "set (exe_name \"oscam-svn\")" CMakeLists.txt || sed -i "s%set (exe_name \"oscam\")%set (exe_name \"oscam-svn\")%" CMakeLists.txt )
   $(shell grep -Fq "GLOB man1_files_svn" CMakeLists.txt || sed -i "s%GLOB man1_files%GLOB man1_files_svn%" CMakeLists.txt )
   $(shell grep -Fq "GLOB man5_files_svn" CMakeLists.txt || sed -i "s%GLOB man5_files%GLOB man5_files_svn%" CMakeLists.txt )

binary-post-install/oscam-svn::
   $(shell touch /var/log/oscam/oscam.log && chmod 666 /var/log/oscam/oscam.log)
